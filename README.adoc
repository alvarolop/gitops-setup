= Red Hat GitOps Environment Setup
Álvaro López Medina <alopezme@redhat.com>
v1.0, 2021-06
// Create TOC wherever needed
:toc: macro
:sectanchors:
:sectnumlevels: 2
:sectnums: 
:source-highlighter: pygments
:imagesdir: images
// Start: Enable admonition icons
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]
ifndef::env-github[]
:icons: font
endif::[]
// End: Enable admonition icons

This repository showcases how to deploy a basic Red Hat Git Ops environment.

// Create the Table of contents here
toc::[]

== Introduction

This repository showcases how to deploy a basic Red Hat Git Ops environment. With this repository, you can deploy many different operator and applications: ArgoCD, GitOps, Tekton, Nexus, etc.



== ArgoCD



== GitOps



== Tekton

[source, bash]
----
oc process -f templates/tekton-01-operator.yaml | oc apply -f -
----

== Nexus


[source, bash]
----
# Define common variables
OPERATOR_NAMESPACE="nexus"

# Deploy operator
oc process -f templates/nexus-01-operator.yaml -p OPERATOR_NAMESPACE=$OPERATOR_NAMESPACE | oc apply -f -

# Workaround for issue: https://github.com/sonatype/operator-nxrm3/issues/8
oc adm policy add-scc-to-user privileged -z default -n $OPERATOR_NAMESPACE

# Deploy application instance
oc process -f templates/nexus-02-server.yaml -p OPERATOR_NAMESPACE=$OPERATOR_NAMESPACE -p SERVER_NAME="nexus-server" | oc apply -f -

# Expose the route
oc expose svc nexus-server-sonatype-nexus-service -n $OPERATOR_NAMESPACE
----



== Prepare environment for workshop

Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque nulla felis, tincidunt ut blandit eget, luctus eu lorem. Nulla ultrices.


[source, bash]
----
oc process -f templates/argocd-01-operator.yaml | oc apply -f -
----

[source, bash]
----
oc process -f templates/tekton-01-operator.yaml | oc apply -f -
----




== Deploy workshop

1) Edit `./env/lab.env` to set the correct OCP cluster.

2) Deploy the workshop documentation and load basic images:
[source, bash]
----
./ocp_import_imgs_cicd.sh
./deploy_lab_pages.sh
----

3) Create workshop projects:
[source, bash]
----
USER=alopezme
for project in $USER-jump-app-dev $USER-jump-app-dev-k8s $USER-jump-app-dev-helm $USER-jump-app-pre $USER-jump-app-pro $USER-jump-app-cicd $USER-gitops-argocd; do
  oc new-project $project
done 
----

4) 
[source, bash]
----
USER=alopezme
oc process -f ./files/argocd_operator.yaml -p USERNAME=$USER | oc apply -f -
sleep 30
oc process -f ./files/argocd_objs.yaml -p USERNAME=$USER | oc apply -f -
----
